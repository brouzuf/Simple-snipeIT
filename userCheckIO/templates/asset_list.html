{% extends 'base.html' %}

{% block title %}Assets for {{ user.name|default:user.username|default:'User' }} ({{ employee_number }}){% endblock %}

{% block content %}
    {# Specific styles for this page - consider moving to a static CSS file if they grow #}
    <style>
        .filter-form { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9;}
        .filter-form label { margin-right: 10px; }
        .filter-form select, .filter-form button { padding: 8px 12px; margin-right: 10px; border-radius: 3px; border: 1px solid #ccc; }
        .filter-form button { background-color: #007bff; color: white; cursor: pointer; }
        .asset-list { list-style-type: none; padding: 0; }
        .asset-list li { background-color: #fff; border: 1px solid #ddd; margin-bottom: 10px; padding: 15px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
        .asset-details { flex-grow: 1; }
        .asset-actions a { margin-left: 10px; text-decoration: none; padding: 5px 10px; border-radius: 3px; }
        .unassign-btn { background-color: #dc3545; color: white; }
        .assign-new-btn { display: inline-block; background-color: #28a745; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px; margin-top: 20px; }
        /* Message class styling is in base.html, but if you have specific ones like .info-message, they need to be defined or moved */
        .message.info-message { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; padding:10px; margin-bottom:15px; border-radius:5px;}
    </style>

    {# Nav links like "Back to Home" and "Logout" are in base.html, so removed from here #}
    {# <nav> <a href="{% url 'index' %}">Back to Home</a> <a href="{% url 'logout' %}">Logout</a> </nav> #}

    <h1>Assets for {{ user.name|default:user.username|default:'User' }} (Employee Number: {{ employee_number }})</h1>

    <div class="filter-form">
        <form method="GET" action="{% url 'user_asset_view' %}">
            <input type="hidden" name="employee_number" value="{{ employee_number }}">
            <label for="category_id">Filter by Category:</label>
            <select name="category_id" id="category_id">
                <option value="">All Categories</option>
                {% for category in categories %}
                    <option value="{{ category.id }}" {% if category.id|stringformat:"s" == selected_category_id|stringformat:"s" %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                {% endfor %}
            </select>
            <button type="submit">Filter</button>
        </form>
    </div>

    <div> {# Changed from class="container" as base.html has a .content div #}
        {% if assets %}
            <ul class="asset-list">
            {% for asset in assets %}
                <li>
                    <div class="asset-details">
                        <strong>{{ asset.name|default:"N/A" }}</strong> (Tag: {{ asset.asset_tag|default:"N/A" }})<br>
                        Model: {{ asset.model.name|default:"N/A" }}<br>
                        Category: {{ asset.category.name|default:"N/A" }}
                    </div>
                    <div class="asset-actions">
                        {% if asset.id %}
                        <a href="{% url 'unassign_asset' asset_id=asset.id %}" class="unassign-btn">Unassign</a>
                        {% endif %}
                    </div>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            {% if selected_category_id %}
                <p class="message info-message">No assets found in this category for this user.</p>
            {% else %}
                <p class="message info-message">No assets currently assigned to this user.</p> {# Ensure .message and .info-message are styled if not using base.html styles #}
            {% endif %}
        {% endif %}

        {% if user.id %}
        <a href="{% url 'assign_asset' user_id=user.id %}" class="assign-new-btn">Assign New Asset</a>
        {% endif %}
    </div>
{% endblock %}
