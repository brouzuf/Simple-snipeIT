{% extends 'base.html' %}

{% block title %}Assets for {{ user.name|default:user.username|default:'User' }} ({{ employee_number }}){% endblock %}

{% block content %}
    <h1 class="title">Assets for {{ user.name|default:user.username|default:'User' }}</h1>
    <p class="subtitle">(Employee Number: {{ employee_number }})</p>

    <div class="box has-background-info-light">
        <form method="GET" action="{% url 'user_asset_view' %}">
            <input type="hidden" name="employee_number" value="{{ employee_number }}">
            <label for="category_id">Filter by Category:</label>
            <select name="category_id" id="category_id">
                <option value="">All Categories</option>
                {% for category in categories %}
                    <option value="{{ category.id }}" {% if category.id|stringformat:"s" == selected_category_id|stringformat:"s" %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                {% endfor %}
            </select>
            <button type="submit">Filter</button>
        </form>
    </div>

    <div class="block">
        {% if assets %}
            <ul class="asset-list">
            {% for asset in assets %}
                <li>
                    <div class="asset-details">
                        <strong>{{ asset.name|default:"N/A" }}</strong> (Tag: {{ asset.asset_tag|default:"N/A" }})<br>
                        Model: {{ asset.model.name|default:"N/A" }}<br>
                        Category: {{ asset.category.name|default:"N/A" }}
                    </div>
                    <div class="asset-actions">
                        {# The user.id is from the user whose asset list is being viewed #}
                        {# This link now goes to a page where an asset tag can be entered for unassignment #}
                        {% if user.id %} {# Ensures we have a user context to pass #}
                        <a href="{% url 'unassign_asset_by_tag' user_id=user.id %}" class="unassign-btn">Unassign by Tag</a>
                        {% endif %}
                    </div>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            {% if selected_category_id %}
                <p class="message info-message">No assets found in this category.</p>
            {% else %}
                <p class="message info-message">No assets currently assigned.</p>
            {% endif %}
        {% endif %}
    </div>
    {% if user.id %}
        <div class="block">
            <a class="button is-large is-primary" href="{% url 'assign_asset' user_id=user.id %}">Assign New Asset</a>
        </div>
    {% endif %}
{% endblock %}
